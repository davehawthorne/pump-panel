<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">

        <title>Lamp Test</title>

        <script src="utils.js"></script>
        <script src="svg.js"></script>
        <script src="lamps.js"></script>
        <script src="widgets_controls.js"></script>
        <script>
            /*global utils svg widgets*/

            "use strict";

            const size = 7;
            var
                bob = [],
                aaa = 0,
                lev,

                sid = function (on) {
                    var i;
                    for (i = 0; i < size * size; i += 1) {
                        bob[i].set((aaa + i) % 10 === 0);
                        if ((aaa + i) % 10 === 5) {
                            bob[i].flash();
                        }
                    }
                    aaa += 1;
                },

                all = function (on) {
                    var i;
                    for (i = 0; i < size * size; i += 1) {
                        bob[i].set(on);
                    }
                },

                pulse = function (on) {
                    var i;
                    for (i = 0; i < size * size; i += 1) {
                        bob[i].pulse();
                    }
                },

                loadSvg = function () {
                    const step = 255 / size;

                    svg.setRoot(document.getElementById("svg1"));

                    svg.create("rect", {x: 0, y: 10, width: 1000, height: 600, fill: "#202090"});
                    new ToggleSwitch({cx: 250, cy: 40, width: 20, text: ["pat"], callback: sid});
                    new ToggleSwitch({cx: 350, cy: 40, width: 20, text: ["all"], callback: all});
                    new ToggleSwitch({cx: 450, cy: 40, width: 20, text: ["pulse"], callback: pulse});
                    for (let j = 0; j < size; j += 1) {
                        for (let i = 0; i < size; i += 1) {
                            bob[i + j * size] = new Lamp({
                                cx: 40 + 60 * i,
                                cy: 120 + 60 * j,
                                rBevel: 20 + i,
                                rGlobe: 13 + j,
                                colour: [i * step, j * step, 250 - i * step / 2 - j * step / 2],
                                interval: 500
                            });
                        }
                    }

                    lev = new LevelIndicator({
                        cx: 600,
                        yTop: 50,
                        lampDist: 50,
                        title: "WATER"
                    });

                    new OutletValve({
                        yTop: 200,
                        yBot: 400,
                        knobWidth: 40,
                        width: 100,
                        height: 300,
                        callback: function (a) {
                            lev.set(1.0 - a);
                        },
                        cx: 800,
                        sideways: 20
                    });

                    lev.set(1.0);

                };


        </script>

    </head>
    <body onload="loadSvg()">
        <h1>Lamp Test</h1>
        <p><a href="./index.html">test index</a></p>
        <svg id="svg1" width="1000" height="600"></svg>
    </body>
</html>
